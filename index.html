<!DOCTYPE HTML>
<html lang="en-us" class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>
      ARIA Disclosure Widget
    </title>
    <meta name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script>
      // remove no-js and add 'js' to the HTML
      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
    </script>
    <link rel="stylesheet" href="assets/css/--demo--.css">
    <link rel="stylesheet" href="assets/css/aria.disclosure.css">
  </head>

  <body id="body">

    <div id="page" class="page">

      <header>
        <h1>
          <abbr title="Accessible Rich Internet Applications">ARIA</abbr>
          Disclosure Widget Patterns
        </h1>
        <p>
          ...
        </p>
      </header>

      <main aria-label="Demo Content">

        <article>
          <h2>
            Example patterns:
          </h2>

          <h3>
            The most minimal
          </h3>
          <div data-disclosure="A generated button">
            <p data-disclosure-content>
              This content will turn into a disclosure
              once the script runs.
            </p>
          </div>


          <section>
            <h3>
              Block Disclosure
            </h3>
            <div id="ex" data-disclosure data-disclosure-type="block">
              <span data-disclosure-btn>
                A full width "button"
              </span>
              <div data-disclosure-content>
                <p>
                  Allows for a large hit area for the disclosure widget's
                  trigger.
                </p>
                <p>
                  <a href="#!">
                    This link is here just for focus testing.
                  </a>
                </p>
              </div>
            </div>
          </section>

          <section>
            <h3>
              Block Disclosure (heading)
            </h3>
            <div id="ex2" data-disclosure data-disclosure-type="block" data-disclosure-open data-disclosure-class="test-class">
              <h4>
                <button data-disclosure-btn>
                  Disclosure button within a heading
                </button>
              </h4>
              <div data-disclosure-content>
                <p>
                  This disclosure widget is opened by default. Because that's a thing that should be able to happen.
                </p>

                <p>
                  Here's an example of a nested flyout disclosure widget:

                  <span data-disclosure="I'm a flyout!" data-disclosure-type="flyout">
                    <span data-disclosure-content>
                      This example has a <a href="#">link within it</a>. Flyouts can
                      be closed via the <kbd>ESC</kbd> key, as long as focus is on the <code>button</code> or within the revealed content.
                      <br>
                      Flyouts will auto-close if focus leaves the flyout.
                    </span>
                  </span>

                  All of this is contained within a single paragraph.
                </p>

                <p>
                  Here's an example of yet another flyout disclosure widget because testing:

                  <span data-disclosure="I'm another flyout!" data-disclosure-hover data-disclosure-type="flyout">
                    <span data-disclosure-content>
                      This one doesn't have a link in it.
                    </span>
                  </span>

                  All of this is contained within a single paragraph.
                </p>
              </div>
            </div>
          </section>

          <section>
            <h3>
              Disclosure Widgets can power navigations
            </h3>

            <p>
              This example showcases how a disclosure widget can be used to create
              an off-site navigation. Using the <code>data-disclosure-manual-classes</code> to
              not add any of the default classes to the widget, and to instead use totally custom
              classes for the component.
            </p>

            <nav aria-label="example" id="my_nav" data-disclosure-type="flyout" data-disclosure data-disclosure-manual-classes>
              <button data-disclosure-btn hidden>
                Menu
              </button>

              <div data-disclosure-content>
                <ul>
                  <li><a href="#">Link 1</a></li>
                  <li><a href="#">Link 2</a></li>
                  <li><a href="#">Link 3</a></li>
                </ul>
              </div>
            </nav>

            <p>
              <a href="#">Focusable element after the navigation</a>.
            </p>
          </section>
        </article>

      </main>

    </div>

    <script src="index.js"></script>
    <script>
      var disclosure = '[data-disclosure]';
      var els = document.querySelectorAll(disclosure);

      // Generate all tab instances
      for ( var i = 0; i < els.length; i++ ) {
        var dis = new A11Ydisclosure( els[i] );
      }

      // navigation example specific:
      var body = document.getElementById('body');
      var nav = document.getElementById('my_nav');
      var navBtn = nav.querySelector('button');
      var navBar = nav.querySelector('[data-disclosure-content]');
      var expandedClass = 'nav-expanded';

      navBtn.addEventListener('click', function () {
        if ( body.classList.contains(expandedClass) ) {
          closeNav();
        }
        else {
          openNav()
        }
      });

      nav.addEventListener('keypress', function ( e ) {
        var keyCode = e.keyCode || e.which;

        switch ( keyCode ) {
          case 13:
            if ( body.classList.contains(expandedClass) ) {
              closeNav();
            }
            else {
              openNav()
            }
            break;

          case 27:
            if ( body.classList.contains(expandedClass) ) {
              closeNav();
            }
            break;
        }
      });

      nav.addEventListener('focusout', function ( e ) {
        setTimeout( function () {
          if ( !nav.contains(document.activeElement) ) {
            closeNav();
          }
        }, 1);
      });

      var openNav = function () {
        body.classList.add(expandedClass);
        document.addEventListener('click', docClick, false);
      }

      var closeNav = function () {
        body.classList.remove(expandedClass);
      }

      var docClick = function ( e ) {
        if ( !nav.contains(e.target) ) {
          closeNav();
          document.removeEventListener('click', docClick);
        }
      }
    </script>
  </body>
</html>

